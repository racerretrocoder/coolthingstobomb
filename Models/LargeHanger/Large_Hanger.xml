<?xml version="1.0"?>

<PropertyList>
<nasal>
  <load>
    <!--
      ##############################################################################
      # The on-load Nasal is not executed when this file is loaded as the user
      # aircraft. The code is only executed if the file is loaded for a remote
      # aircraft in Multi-Player mode (MP)
      ##############################################################################
    -->
    <![CDATA[
      var livery_update = aircraft.livery_update.new("Aircraft/coolthingstobomb/Models/LargeHanger/Liveries");

# smallsearch to avoid multiple nodes
var smallsearch = func(cs=nil) {
  var list = props.globals.getNode("/ai/models").getChildren("multiplayer");
  var total = size(list);
  var mpid = 0;
  for(var i = 0; i < total; i += 1) {
      if (cs != nil) {
      # were searching for someone...
      if (getprop("ai/models/multiplayer[" ~ i ~ "]/callsign") == cs) {
          mpid = i;
          return mpid; # Bam!
          
     }
      var callsign = list[i].getNode("callsign").getValue();
     }
   }
}

 var rplayer = cmdarg(); 
   #rplayer.getNode("orientation/alpha-deg", 1).
   #  alias(rplayer.getNode("sim/multiplay/generic/float[17]")); #for vapor
   #rplayer.getNode("controls/engines/engine/throttle", 1).
   #  alias(rplayer.getNode("sim/multiplay/generic/float[18]")); #for AB
   #rplayer.getNode("velocities/airspeed-kt", 1).
   #  alias(rplayer.getNode("sim/multiplay/generic/float[19]")); #for vapor (2)
	 # Stores parser
	 var cs1 = rplayer.getNode("sim/multiplay/callsign", 1);
	 var callsign = cs1.getValue();
	 var mpid = smallsearch(callsign);
	var stringparse = func() {
		var mpid = smallsearch(callsign);
		var string5 = getprop("ai/models/multiplayer[" ~ mpid ~ "]/sim/multiplay/generic/string[5]");
 		var thesplit = split(":", string5);
		#size of thesplit: "~size(thesplit));
		#Grab pylon number");
		var pylon = thesplit[0];
		#setting weight");
		setprop("ai/models/multiplayer[" ~ mpid ~ "]/sim/weight[" ~ pylon ~ "]/selected",thesplit[1]);
		#setting armament");
		setprop("ai/models/multiplayer[" ~ mpid ~ "]/controls/armament/station[" ~ pylon ~ "]/release",num(thesplit[3]));
		#self.getNode("sim/weight[" ~ pylon ~ "]/selected",1).setValue(thesplit[1]); These is acting strange...
		#self.getNode("controls/armament/station[" ~ pylon ~ "]/release",1).setValue(num(thesplit[3]));
	}
	#var stringtimer = maketimer(1,stringparse);
	#stringtimer.start();
	print("Large Hanger Loaded in");
	setprop("ai/models/multiplayer[" ~ mpid ~ "]/f22/ground/pilot",1);

    ]]>

    </load>
  
 <unload><![CDATA[
    livery_update.stop();
	#stringtimer.stop();
	print("Large Hanger: Leaving! See you next time :)");
  ]]></unload>
</nasal>



  <path>Aircraft/coolthingstobomb/Models/LargeHanger/LargeHanger.ac</path>
	<!--<animation>
		<type>rotate</type>
		<object-name>probe</object-name>
        <object-name>dish</object-name>
        <object-name>middish</object-name>
		<property>controls/radar/dish/pitch</property>
		<axis>   
        <object-name>pitch-axis</object-name>
		</axis>
	</animation>
		<animation>
		<type>rotate</type>

        <object-name>rdr</object-name>
		<property>controls/radar/dish/hdg</property>
		<axis>   
        <object-name>spin-axis</object-name>
		</axis>
	</animation>-->


 <animation>
  <type>translate</type>
  <object-name>door1fl</object-name>
  <property>sim/multiplay/generic/float[1]</property>
  <factor>-20</factor>
  <offset-m>0</offset-m>
  <axis>
   <x>1</x>
   <y>0</y>
   <z>0</z>
  </axis>
 </animation>
 <animation>
  <type>translate</type>
  <object-name>door1fr</object-name>
  <property>sim/multiplay/generic/float[1]</property>
  <factor>20</factor>
  <offset-m>0</offset-m>
  <axis>
   <x>1</x>
   <y>0</y>
   <z>0</z>
  </axis>
 </animation>



<animation>
  <type>material</type>
  <object-name>logo1</object-name>
  <property-base>sim/model/livery</property-base>
  <texture-prop>texture-logo1</texture-prop>
  <texture>Liveries/LH1.png</texture>
</animation>


<!--Custom lighting-->

    <light>
        <name>mainlight</name>
        <type>spot</type>
        <position>
        <x-m>4</x-m>
	      <y-m>-80</y-m>
		    <z-m>5</z-m>
        </position>
        <direction>
            <x>0</x>
            <y> 100</y>
            <z> 0</z>
        </direction>
        <ambient>
            <r>1.00</r>
            <g>0.95</g>
            <b>0.95</b>
            <a>0</a>
        </ambient>
        <diffuse>
            <r>1</r>
            <g>1</g>
            <b>1</b>
            <a>0</a>
        </diffuse>
        <specular>
            <r>1</r>
            <g>1</g>
            <b>1</b>
            <a>0</a>
        </specular>
        <dim-factor>
            <property>controls/gear/gear-down</property>
        </dim-factor>
        <attenuation>
            <c>1.0</c>
            <l>0.0225</l>
            <q>0.000001875</q>
        </attenuation>
        <spot-cutoff>60</spot-cutoff>
        <spot-exponent>40</spot-exponent>
        <range-m>50</range-m>
    </light>


    <light>
        <name>mainlight</name>
        <type>spot</type>
        <position>
        <x-m>4</x-m>
	      <y-m>30</y-m>
		    <z-m>5</z-m>
        </position>
        <direction>
            <x>0</x>
            <y> -100</y>
            <z> 0</z>
        </direction>
        <ambient>
            <r>1.00</r>
            <g>0.95</g>
            <b>0.95</b>
            <a>0</a>
        </ambient>
        <diffuse>
            <r>1</r>
            <g>1</g>
            <b>1</b>
            <a>0</a>
        </diffuse>
        <specular>
            <r>1</r>
            <g>1</g>
            <b>1</b>
            <a>0</a>
        </specular>
        <dim-factor>
            <property>controls/gear/gear-down</property>
        </dim-factor>
        <attenuation>
            <c>1.0</c>
            <l>0.0225</l>
            <q>0.000001875</q>
        </attenuation>
        <spot-cutoff>60</spot-cutoff>
        <spot-exponent>40</spot-exponent>
        <range-m>50</range-m>
    </light>




</PropertyList>

